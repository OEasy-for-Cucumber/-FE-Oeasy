import{r as l,a as R,b as T,j as A,i as u,c as X,D as q,G}from"./index-C3_MdCAa.js";import{s as O}from"./show-n0aZwl5U.js";import{P as $,c as _,e as AA}from"./Pagination-tt-CghKP.js";import{u as F}from"./useConfirm-D_jcnQWj.js";import{p as W,f as V,a as K,k as Y}from"./ko-B-iMc5bu.js";import"./rightArrow-89cJ_8Fk.js";const z="data:image/webp;base64,UklGRqYCAABXRUJQVlA4WAoAAAAwAAAARwAARwAASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZBTFBIbgAAAAFPQCBAGeRBD3hCRITg8aBgWlt7kyTUBZpkBCySMRghI8SBRPdv3vQiIyL6ryBtA6Y1sOOCZB2uryi8M0w/cDLfDDsAjL4ZLsnmm+GTcN8MUEwhwysRvhkeyeKb4ZC07hnCfKcdPH+8I+4Zcg4JVlA4IEIAAADQBACdASpIAEgAPm0ukkYkIqGhLggAgA2JaQAAbHfJTDx+2mWbW7DkpmQK+RLzgAD++5zfSl//+39glf/HaAAAAAA=",eA="data:image/webp;base64,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";function tA({communityId:x,setTotalComments:H}){const[m,s]=l.useState(!1),[j,N]=l.useState(null),[w,k]=l.useState(null),[i,a]=l.useState(1),o=R(t=>t.user),[b,y]=l.useState([]),[v,C]=l.useState(0),[g,P]=l.useState(""),[D,B]=l.useState(!1),[d,h]=l.useState(""),{showConfirm:E}=F(),{showAlert:c}=T(),p=async t=>{try{const e=await u.get("/api/community/comment",{params:{communityPk:x,page:t-1,size:5}}),{contents:n,totalPages:r,totalElements:f}=e.data;y(n.reverse()),C(r),H(f)}catch(e){console.error("댓글을 불러오는 중 오류 발생:",e)}};l.useEffect(()=>{p(i),window.scrollTo({top:document.body.scrollHeight})},[x,i]);function U(t){const e=t.split(".")[0],n=W(e);return(new Date().getTime()-n.getTime())/(1e3*60*60)<24?V(n,{addSuffix:!0,locale:Y}):K(n,"yy.MM.dd")}const L=t=>{s(e=>!(e&&j===t)),N(t===j?null:t)},I=async()=>{if(D)return;if(!g.trim){c({message:"댓글을 입력해주세요"});return}B(!0);const t={communityId:x,memberId:o==null?void 0:o.memberPk,content:g,size:5};try{await u.post("/api/community/comment",t),P(""),await p(i)}catch(e){console.error("댓글 등록 중 오류 발생:",e)}finally{B(!1)}},M=(t,e)=>{k(t),h(e),s(!1)},S=async t=>{const e=b.find(r=>r.commentPk===t);if((e==null?void 0:e.content)===d.trim()){c({message:"변경된 내용이 없습니다"});return}if(!d.trim()){c({message:"수정할 내용을 입력해주세요."});return}const n={memberId:o==null?void 0:o.memberPk,commentId:t,content:d};try{await u.patch("/api/community/comment",n),c({message:"댓글이 수정되었습니다."}),k(null),await p(i)}catch(r){console.error("댓글 수정 중 오류 발생:",r),c({message:"댓글 수정에 실패했습니다."})}},Q=async t=>{E({message:"댓글을 삭제할까요?",onConfirm:async()=>{const e={memberId:o==null?void 0:o.memberPk,commentId:t};try{await u.delete("/api/community/comment",{data:e}),c({message:"댓글이 삭제되었습니다."}),await p(i)}catch(n){console.error("댓글 삭제 중 오류 발생:",n),alert("댓글 삭제에 실패했습니다.")}}})},Z=(t,e)=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),S(e))};return A.jsx(A.Fragment,{children:A.jsxs("div",{className:"flex flex-col",children:[A.jsx("p",{className:"pb-6 font-b1-semibold",children:"댓글"}),A.jsx("div",{className:"divide-y divide-grayoe-800",children:b.map(t=>A.jsxs("div",{className:"flex justify-between pt-4",children:[A.jsxs("div",{className:"flex gap-2",children:[A.jsx("img",{src:t.profileImg??"/img/defaultProfile.webp",alt:"프로필이미지",className:"w-6 h-6 rounded-full"}),A.jsxs("div",{className:"flex flex-col gap-[2px] mb-4",children:[A.jsx("p",{className:"font-b2-semibold xl:font-b1-semibold",children:t.nickname}),w===t.commentPk?A.jsx("textarea",{value:d,onChange:e=>h(e.target.value),onKeyDown:e=>Z(e,t.commentPk),className:"w-[400px] xl:w-[630px] bg-grayoe-950 p-2 border font-b2-regular xl:font-b1-regular border-grayoe-600 rounded resize-none focus:outline-none"}):A.jsx("p",{className:"font-b2-regular xl:font-b1-regular",children:t.content}),A.jsx("p",{className:"font-c2 text-grayoe-300",children:t.createTime?U(t.createTime):"날짜 정보 없음"})]})]}),(o==null?void 0:o.memberPk)===t.memberId&&A.jsxs("div",{className:"flex flex-col items-end font-c2 relative",children:[A.jsx("img",{src:z,alt:"Edit icon",className:"w-4 h-4 cursor-pointer",onClick:()=>L(t.commentPk)}),m&&j===t.commentPk&&A.jsxs(A.Fragment,{children:[A.jsx("div",{className:"fixed top-0 left-0 w-[100%] h-[100%] z-10 ",onClick:()=>s(!1)}),A.jsxs("div",{className:"absolute z-20 top-6 right-0 w-14 font-c2 bg-grayoe-400 rounded-md shadow-lg flex flex-col",children:[A.jsx("button",{className:"py-2 px-4  rounded",onClick:()=>M(t.commentPk,t.content),children:"수정"}),A.jsx("button",{className:"py-2 px-4  rounded",onClick:()=>Q(t.commentPk),children:"삭제"})]})]}),w===t.commentPk&&A.jsx("button",{className:"mt-2  font-bold",onClick:()=>S(t.commentPk),children:"저장"})]})]},t.commentPk))}),A.jsxs("div",{className:"w-full px-4 py-2 bg-grayoe-400 rounded-md h-[116px]  flex flex-col justify-between gap-1",children:[A.jsx("p",{className:"mt-1 font-b2-semibold xl:font-b1-semibold",children:o==null?void 0:o.nickname}),A.jsx("textarea",{value:g,onChange:t=>P(t.target.value),className:"w-full mt-1 h-auto font-b2-regular xl:font-b1-regular focus:outline-none bg-grayoe-400 placeholder-grayoe-200 resize-none",placeholder:"댓글을 입력해주세요.",onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),I())}}),A.jsx("div",{className:"flex justify-end",children:A.jsx("button",{onClick:I,disabled:D||!g.trim(),className:`w-11 h-7 font-b2-regular xl:font-b1-regular text-${g.trim()?"greenoe-600":"grayoe-200"} rounded-md flex justify-center items-center `,children:"등록"})})]}),A.jsx("div",{children:b.length>0&&A.jsx("div",{className:"w-full flex justify-center",children:A.jsx($,{totalPageNumber:v,currentPage:i,setCurrentPage:a})})})]})})}function iA(){const x=X(),H=q(),{cmnId:m}=H.state,[s,j]=l.useState(null),[N,w]=l.useState(!1),[k,i]=l.useState(0),a=R(e=>e.user),[o,b]=l.useState(!1),[y,v]=l.useState(null),C=l.useRef(null),[g,P]=l.useState(0),{showConfirm:D}=F(),{showAlert:B}=T(),[d,h]=l.useState(null),[E,c]=l.useState(!1);l.useEffect(()=>{m&&p()},[a]);const p=async()=>{try{const e=await u.get(`api/community/${m}/${a==null?void 0:a.memberPk}`,{params:{cmnId:m,memberId:a==null?void 0:a.memberPk}});j(e.data),w(e.data.liked),i(e.data.likes)}catch(e){console.error("게시물 데이터를 가져오는 중 오류 발생:",e)}},U=async()=>{try{const e=await u.get(`/api/community/like/${m}/${a==null?void 0:a.memberPk}`,{params:{cmnId:m,memberId:a==null?void 0:a.memberPk}});w(e.data),e.data===!0?i(n=>n+1):i(n=>n-1)}catch(e){console.error("좋아요 상태 업데이트 실패:",e)}},L=e=>{const{top:n,left:r,height:f}=e.currentTarget.getBoundingClientRect();b(J=>!J),v({top:n+f+window.scrollY,left:r+window.scrollX-35}),C.current=e.currentTarget},I=()=>{x("/community/upload",{state:{postData:s}})};l.useEffect(()=>{const e=()=>{if(o&&C.current){const{top:n,left:r,height:f}=C.current.getBoundingClientRect();v({top:n+f+window.scrollY,left:r+window.scrollX-35})}};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[o]);const M=e=>{const n=W(e);return(new Date().getTime()-n.getTime())/(1e3*60*60)<24?V(n,{addSuffix:!0,locale:Y}):K(n,"yy.MM.dd")},S=async()=>{D({message:"게시물을 삭제할까요?",subMessage:"삭제한 글은 되돌릴 수 없어요.",onConfirm:async()=>{const e={userId:a==null?void 0:a.memberPk,cmnId:m};try{await u.delete("/api/community",{data:e}),B({message:"게시물이 삭제되었습니다."}),x("/community")}catch(n){console.error("게시물 삭제 중 오류 발생:",n),B({message:"게시물 삭제에 실패했습니다."})}}})},Q=e=>{h(e),c(!0)},Z=()=>{c(!1),h(null)},t=e=>{h(e)};return A.jsx(A.Fragment,{children:A.jsxs("div",{className:"xl:w-[864px] mx-auto",children:[A.jsxs("div",{className:"px-6 py-6 divide-y divide-grayoe-800",children:[s?A.jsxs("div",{className:"flex flex-col gap-2 pb-6",children:[A.jsx("p",{className:"font-h5 xl:font-h4",children:s.title}),A.jsxs("div",{className:"flex justify-between",children:[A.jsxs("div",{className:"flex gap-2",children:[A.jsx("img",{src:s.profileImg||G,alt:"",className:"w-10 h-10 rounded-full"}),A.jsxs("div",{className:"flex flex-col justify-center items-start gap-1",children:[A.jsx("p",{className:"font-b2-semibold",children:s.nickname}),A.jsx("p",{className:"font-c2 text-grayoe-300",children:M(s.createdAt)})]})]}),A.jsxs("div",{className:"flex gap-2 justify-center items-end font-c2",children:[A.jsxs("div",{className:"flex justify-center items-center gap-1",children:[A.jsx("img",{src:O,alt:"조회수",className:"w-[14px] h-[14px]"}),A.jsx("p",{children:s.view})]}),A.jsxs("div",{className:"flex justify-center items-center gap-1",children:[A.jsx("img",{src:_,alt:"댓글아이콘",className:"w-[14px] h-[14px]"}),A.jsx("p",{children:g})]}),(a==null?void 0:a.nickname)===s.nickname&&A.jsxs(A.Fragment,{children:[A.jsx("img",{src:z,alt:"Edit icon",className:"w-4 h-4 cursor-pointer",onClick:L}),o&&y&&A.jsxs("div",{className:"absolute bg-grayoe-400 rounded-md shadow-lg w-14 h-18 flex flex-col justify-center items-center",style:{top:`${y.top}px`,left:`${y.left}px`},children:[A.jsx("div",{className:"py-2 cursor-pointer  rounded",onClick:I,children:"수정"}),A.jsx("div",{className:"py-2 cursor-pointer rounded",onClick:S,children:"삭제"})]})]})]})]})]}):A.jsx("p",{children:"로딩중"}),A.jsxs("div",{className:"pt-6",children:[A.jsx("p",{className:"font-b2-regular xl:font-b1-regular",children:(s==null?void 0:s.content)??"내용이 없습니다."}),(s==null?void 0:s.imageUrlList)&&s.imageUrlList.length>0&&A.jsx("div",{className:`pt-6 ${s.imageUrlList.length===1?"":s.imageUrlList.length===2?"grid grid-rows-1 gap-2 pb-2 grid-cols-2":s.imageUrlList.length===3?"grid-rows-1 gap-2 pb-2 xl:grid-cols-3 xl:grid-rows-1":s.imageUrlList.length===4?"grid-rows-1 gap-2 pb-2 xl:grid-cols-2 xl:grid-rows-2":"grid-rows-1 gap-2 pb-2 xl:grid-cols-3 xl:grid-rows-2"} xl:grid xl:gap-2 xl:justify-center ${s.imageUrlList.length>1?"overflow-x-auto scrollbar-hidden flex xl:grid":""}`,children:s.imageUrlList.map((e,n)=>A.jsx("img",{src:e,alt:`게시물 이미지 ${n+1}`,className:`w-full rounded-lg ${s.imageUrlList.length===1?"h-auto":s.imageUrlList.length===2?"w-full h-[180px] xl:h-[240px]":"w-[162px] xl:w-full h-[180px] xl:h-[180px]"} `,onClick:()=>Q(n)},n))}),E&&s&&d!==null&&A.jsxs(A.Fragment,{children:[A.jsx("div",{className:"fixed top-0 left-0 w-full h-full z-60 bg-black ",onClick:()=>c(!1)}),A.jsx("button",{className:"fixed top-4 left-4 text-white text-2xl z-70",onClick:Z,children:"✕"}),A.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-auto h-auto flex flex-col items-center justify-center z-70",children:[A.jsx("div",{children:A.jsx("img",{src:s.imageUrlList[d],alt:"확대된 이미지",className:"max-w-full max-h-screen rounded-lg"})}),s.imageUrlList.length>1&&A.jsx("div",{className:"flex gap-2 mt-4",children:s.imageUrlList.map((e,n)=>A.jsx("button",{className:`w-3 h-3 rounded-full ${n===d?"bg-white":"bg-gray-400"}`,onClick:()=>t(n)},n))})]})]}),A.jsxs("div",{className:"flex justify-start items-center gap-1 pt-6",children:[A.jsx("img",{src:N?eA:AA,alt:N?"꽉 찬 하트":"빈 하트",className:"w-5 h-5 cursor-pointer",onClick:U}),A.jsx("p",{className:"font-b2-regular",children:k})]})]})]}),A.jsx("div",{className:"border-grayoe-900 border-4 w-full xl:hidden"}),A.jsx("div",{className:"py-6 px-6",children:A.jsx(tA,{communityId:m,setTotalComments:P})})]})})}export{iA as default};
